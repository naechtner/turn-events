{% extends "gymnastics/streams/base.html" %}

{% load custom_template_tags %}

{% block nav_controller_active %}<li>{% endblock nav_controller_active %}
{% block nav_action_active %}<li class="active">{% endblock nav_action_active %}
{% block action %}detail{% endblock action %}

{% block content %}

  <div class="row row-relative">
    <div class="col-md-8">
      <h1>
        {{ stream }}
        <small>
        </small>
      </h1>
    </div>
    <div class="col-md-4 div-pos-bottom-right text-right">
      <div class="btn-group">
        <a type="button" class="btn btn-warning" href="{% url 'streams.edit' stream.id %}">Edit</a>
        <a type="button" class="btn btn-danger" href="{% url 'streams.delete' stream.id %}">Delete</a>
        <button type="button" class="btn btn-default" onClick="javascript:history.go(-1);">Previous Page</button>
      </div>
    </div>
  </div>

  <div role="tabpanel">
    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active"><a href="#base" aria-controls="home" role="tab" data-toggle="tab">Base</a></li>
      <li role="presentation"><a href="#athletes" aria-controls="messages" role="tab" data-toggle="tab">Athletes ({{ stream.athlete_set.count }})</a></li>
      <li role="presentation"><a href="#results" aria-controls="profile" role="tab" data-toggle="tab">Results</a></li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="base">
        <p>Difficulty: {{ stream.difficulty }}</p>
        <p>Sex: {{ stream.get_sex_display }}</p>
        <p>Minimum Year of birth: {{ stream.minimum_year_of_birth }}</p>
        <p>Disciplines:
        <ul>
          {% for discipline in stream.discipline_set.all %}
            <li><a href="{% url 'disciplines.detail' discipline.id %}">{{ discipline }}</a></li>
          {% endfor %}
        </ul>
        </p>
        <p>Performances are compared in 
        <ul>
          {% if stream.all_around_individual %}
            <li>all around individual: {{ stream.all_around_individual_counting_events }} counting disciplines</li>
          {% endif %}
          {% if stream.all_around_team %}
            <li>team performances: {{ stream.all_around_team_counting_athletes }} counting events per discipline</li>
          {% endif %}
          {% if stream.discipline_finals %}
            <li>discipline finals: {{ stream.discipline_finals_max_participants }} participants</li>
          {% endif %}
        </ul></p>
      </div>

      <div role="tabpanel" class="tab-pane" id="athletes"> 
        <table class="table table-hover" id="athletes-table">
          <thead>
            <th>Name</th>
            <th>Sex</th>
            <th>Year of birth</th>
            <th>Club</th>
            <th>Squad</th>
            <th>Team</th>
          </thead>
          <tbody>
            {% for athlete in stream.athlete_set.all %}
              <tr id="athlete_{{ athlete.id }}">
                <td><a href="{% url 'athletes.detail' athlete.id %}">{{ athlete }}</a></td>
                {% if athlete.sex == 'f' %}
                  <td class="gend gend-female"> &#9792;</td>
                {% else %}
                  <td class="gend gend-male"> &#9794;</td>
                {% endif %}
                <td>{{ athlete.year_of_birth }}</td>
                <td><a href="{% url 'clubs.detail' athlete.club.id %}">{{ athlete.club }}</a></td>
                <td><a href="{% url 'squads.detail' athlete.squad.id %}">{{ athlete.squad }}</a></td>
                <td><a href="{% url 'teams.detail' athlete.team.id %}">{{ athlete.team }}</a></td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div role="tabpanel" class="tab-pane" id="results">
        {% with disciplines=stream.discipline_set.all %}
          {% if stream.all_around_individual %}
            <div>All around individual:</div>
            <table class="table table-hover table-condensed" id="stream-table">
              <thead>
                <th>Athlete</th>
                  {% for discipline in disciplines %}
                    <th><a href="{% url 'disciplines.detail' discipline.id %}">{{ discipline }}</a></th>
                  {% endfor %}
                <th>Total</th>
              </thead>
              <tbody>
                {% for athlete in stream.athlete_set.all %}
                  <tr id="athlete_{{ athlete.id }}">
                    <td><a href="{% url 'athletes.detail' athlete.id %}">{{ athlete }}</a></td>
                      {% with athlete_performances=athlete.performances %}
                        {% for discipline in disciplines %}
                          <td>
                            {% if athlete_performances|get_item:discipline %}
                               {{ athlete_performances|get_item:discipline }}
                            {% endif %}
                          </td>
                        {% endfor %}
                      {% endwith %}
                    <td>
                      {% if athlete.performance_total %}
                        {{ athlete.performance_total }}
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% endif %}
          {% if stream.all_around_team %}
            <div>All around team (toDo):</div>
            <table class="table table-hover table-condensed" id="stream-table">
              <thead>
                <th>Athlete</th>
                  {% for discipline in disciplines %}
                    <th><a href="{% url 'disciplines.detail' discipline.id %}">{{ discipline }}</a></th>
                  {% endfor %}
                <th>Total</th>
              </thead>
              <tbody>
              </tbody>
            </table>
          {% endif %}
          {% if stream.discipline_finals %}
            <div>Discipline finals (toDo):</div>
            <table class="table table-hover table-condensed" id="stream-table">
              <thead>
                <th>Athlete</th>
                  {% for discipline in disciplines %}
                    <th><a href="{% url 'disciplines.detail' discipline.id %}">{{ discipline }}</a></th>
                  {% endfor %}
                <th>Total</th>
              </thead>
              <tbody>
              </tbody>
            </table>
          {% endif %}
        {% endwith %}
      </div>
    </div>
  </div> 
  
{% endblock content %}