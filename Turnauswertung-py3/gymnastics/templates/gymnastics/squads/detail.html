{% extends "gymnastics/squads/base.html" %}

{% load custom_template_tags %}

{% block nav_level_2 %}
  {% render_nav_item name=squad active=True %}
{% endblock nav_level_2 %}

{% block content %}

  <div class="row row-relative">
    <div class="col-md-7">
      <h1>
        {{ squad }} <small>{{ athletes_count }} Athletes</small>
      </h1>
    </div>
    <div class="col-md-5 div-pos-bottom-right text-right">
      <div class="btn-group">
        <a type="button" class="btn btn-primary" href="{% url 'squads.enter_performances' squad.id %}">Enter performances</a>
        <a type="button" class="btn btn-warning" href="{% url 'squads.edit' squad.id %}">Edit</a>
        <a type="button" class="btn btn-danger" href="{% url 'squads.delete' squad.id %}">Delete</a>
        <button type="button" class="btn btn-default" onClick="javascript:history.go(-1);">Previous Page</button>
      </div>
    </div>
  </div>

  <div role="tabpanel">
    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active"><a href="#athletes" aria-controls="home" role="tab" data-toggle="tab">Athletes</a></li>
      <li role="presentation"><a href="#performances" aria-controls="messages" role="tab" data-toggle="tab">Performances</a></li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="athletes">
        <table class="table table-hover table-condensed" id="athletes-table">
          {% include "base/athletes_list.html" with athletes_set=athletes only %}
        </table>
      </div>

      
      <div role="tabpanel" class="tab-pane" id="performances">
        {% for stream in streams %}
          {% with stream_id=stream.id %}
            <div class="panel panel-default">
              <div class="panel-heading text-center">
                <a data-toggle="collapse" href="#collapse_{{ stream_id }}" aria-expanded="true" aria-controls="collapse_{{ stream_id }}">
                  <h3 class="panel-title">{{ stream }}</h3>
                </a>
              </div>
              {% with disciplines=stream_athletes_disciplines|get_item:stream_id|get_item:'disciplines' stream_athletes=stream_athletes_disciplines|get_item:stream_id|get_item:'athletes' %}
                <div id="collapse_{{ stream_id }}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                  <table class="table table-hover table-condensed" id="stream-{{ stream }}-table">
                    <thead>
                      <th>Athlete</th>
                      {% for discipline in disciplines %}
                        <th>{{ discipline }}</th>
                      {% endfor %}
                    </thead>
                    <tbody>
                        {% for athlete in stream_athletes %}
                          <tr id="athlete_{{ athlete.id }}">
                            {% with athlete_performances=athletes_disciplines_result_dict|get_item:athlete.id %}
                              <td><a href="{% url 'athletes.detail' athlete.id %}">{{ athlete }}</a></td>
                              {% for discipline in disciplines %}
                                <td>
                                  {{ athlete_performances|get_item:discipline.id }}
                                </td>
                              {% endfor %}
                            {% endwith %}
                          </tr>
                        {% endfor %}
                    </tbody>
                  </table>
                </div>
              {% endwith %}
            </div>
          {% endwith %}
        {% endfor %}
      </div>
    </div>
  </div>
  
{% endblock content %}