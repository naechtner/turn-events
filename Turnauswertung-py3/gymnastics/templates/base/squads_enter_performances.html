{% load widget_tweaks %}

{% load custom_template_tags %}

{% comment %}
  Values that can be set:
    streams 
      - list of streams to be shown
    stream_athletes_disciplines
      - dictionary of lists with:
        - key: athletes -> all athletes in this stream
        - key disciplines -> all disciplines of this stream
    athletes_disciplines_result_dict
      - dictionary of dictionaries (key: athlete, values: disciplines)
        - disciplines are keys for their performance_values

{% endcomment %}

<div class="form-group row {% if form.errors|get_item:field.name %} has-error{% endif %}">
  {% for stream in streams %}
    {% with stream_id=stream.id %}
      <div class="panel panel-default">
        <div class="panel-heading text-center">
          <a data-toggle="collapse" href="#collapse{{ stream_id }}" aria-expanded="true" aria-controls="collapse{{ stream_id }}">
            <h3 class="panel-title">{{ stream }}</h3>
          </a>
        </div>
        {% with disciplines=stream_athletes_disciplines|get_item:stream_id|get_item:'disciplines' stream_athletes=stream_athletes_disciplines|get_item:stream_id|get_item:'athletes' %}
          <div id="collapse{{ stream_id }}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
            <table class="table table-hover table-condensed" id="stream-{{ stream }}-table">
              <thead>
                <th>Athlete</th>
                {% for discipline in disciplines %}
                  <th>{{ discipline }}</th>
                {% endfor %}
              </thead>
              <tbody>
                {% for athlete in stream_athletes %}
                  <tr id="athlete_{{ athlete.id }}">
                    {% with athlete_performances=athletes_disciplines_result_dict|get_item:athlete.id %}
                      <td><a href="{% url 'athletes.detail' athlete.id %}" tabindex="-1">{{ athlete }}</a></td>
                      {% for discipline in disciplines %}
                        <td>
                          <div class="col-md-6">
                            <input type="number" min="0.00" max="10.00" step="0.01" class="form-control" id="{{ athlete.id }}-{{ discipline.id }}" placeholder="{{ athlete_performances|get_item:discipline.id|default:'0.00' }}">
                          </div>
                        </td>
                      {% endfor %}
                    {% endwith %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% endwith %}
      </div>
    {% endwith %}
  {% endfor %}
</div>